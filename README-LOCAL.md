# نظام إدارة التدريب الميداني - الإعداد المحلي

## المشكلة والحل

عند تشغيل النظام محلياً على المنفذ 8080، هناك اختلافات في الإعداد عن النسخة المستضافة. هذا الدليل يوضح كيفية إعداد النظام للعمل بشكل صحيح محلياً.

## الخطوات المطلوبة

### 1. إعداد قاعدة البيانات

```bash
# إنشاء قاعدة بيانات محلية
createdb training_system

# أو باستخدام psql
psql -c "CREATE DATABASE training_system;"
```

### 2. إعداد متغيرات البيئة

إنشاء ملف `.env` في مجلد المشروع:

```env
# قاعدة البيانات المحلية
DATABASE_URL=postgresql://username:password@localhost:5432/training_system

# إعدادات الخادم
PORT=8080
NODE_ENV=development

# مفتاح الجلسة
SESSION_SECRET=your_secret_key_here_for_local_dev

# إعدادات إضافية للبيئة المحلية
VITE_API_URL=http://localhost:8080
```

### 3. تشغيل سكريبتات الإعداد

```bash
# 1. إنشاء جداول قاعدة البيانات
node scripts/db-push.js

# 2. إعداد البيانات الأساسية
npx tsx scripts/setup-local.js

# أو يمكنك تشغيل السكريبتات منفصلة:
npx tsx scripts/seed-faculties.js
npx tsx scripts/seed-levels.js
```

### 4. تشغيل التطبيق على المنفذ 8080

```bash
# تشغيل على المنفذ 8080
PORT=8080 npm run dev

# أو
PORT=8080 NODE_ENV=development tsx server/index.ts
```

## معلومات تسجيل الدخول

بعد إعداد النظام محلياً، يمكنك استخدام:

### المسؤول
- **اسم المستخدم:** admin
- **كلمة المرور:** admin123
- **الرابط:** http://localhost:8080/admin-login

### لإنشاء مشرف جديد
1. سجل دخول كمسؤول
2. اذهب إلى "المشرفون" في القائمة الجانبية
3. انقر "إضافة مشرف جديد"

### لإنشاء طلاب
1. سجل دخول كمسؤول
2. اذهب إلى "الطلاب" في القائمة الجانبية
3. انقر "إضافة طالب جديد" أو استخدم "استيراد من Excel"

## الاختلافات الأساسية بين البيئة المحلية والمستضافة

| الخاصية | البيئة المحلية | البيئة المستضافة |
|---------|----------------|------------------|
| المنفذ | 8080 | 5000 |
| قاعدة البيانات | PostgreSQL محلية | NeonDB |
| كلمات المرور | غير مشفرة للسهولة | مشفرة بـ bcrypt |
| متغيرات البيئة | ملف .env محلي | متغيرات Replit |

## حل المشاكل الشائعة

### 1. خطأ "المنفذ مستخدم"
```bash
# إيقاف العمليات التي تستخدم المنفذ 8080
lsof -ti:8080 | xargs kill -9

# أو استخدم منفذ آخر
PORT=3000 npm run dev
```

### 2. خطأ اتصال قاعدة البيانات
- تأكد من تشغيل PostgreSQL محلياً
- تحقق من صحة معلومات الاتصال في `.env`
- تأكد من وجود قاعدة البيانات:
```bash
psql -l | grep training_system
```

### 3. صفحات مفقودة أو لا تعمل
```bash
# إعادة تشغيل الإعداد الكامل
node scripts/db-push.js
npx tsx scripts/setup-local.js
```

### 4. مشاكل في الإشعارات
تأكد من وجود جدول الإشعارات:
```sql
-- تشغيل في psql
\c training_system
\dt
-- يجب أن ترى جدول notifications
```

## الميزات المتوفرة محلياً

- ✅ إدارة المستخدمين والأدوار
- ✅ إدارة الكليات والتخصصات  
- ✅ إدارة السنوات الدراسية
- ✅ إدارة مواقع التدريب
- ✅ إدارة الدورات التدريبية
- ✅ نظام التعيينات والتسجيل
- ✅ نظام التقييم والدرجات
- ✅ نظام الإشعارات
- ✅ التقارير والإحصائيات
- ✅ تصدير البيانات

## نصائح للتطوير المحلي

1. **استخدم قاعدة بيانات منفصلة للتطوير**
2. **احتفظ بنسخة احتياطية من البيانات التجريبية**
3. **استخدم كلمات مرور بسيطة للتطوير فقط**
4. **تأكد من تشغيل PostgreSQL قبل بدء التطبيق**

## الدعم

إذا واجهت مشاكل في الإعداد المحلي:
1. تأكد من تشغيل جميع السكريبتات بالترتيب الصحيح
2. تحقق من ملف `.env` وتأكد من صحة المعلومات
3. راجع سجلات الأخطاء في Terminal للحصول على تفاصيل أكثر